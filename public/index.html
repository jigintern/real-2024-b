<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <title>HeyHey</title>
    <link rel="stylesheet" href="style.css" />
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const signUpButton = document.getElementById("signUpButton");
        const nameInput = document.getElementById("nameInput");
        const activeInput = document.getElementById("activeInput");
        const name = localStorage.getItem("name");
        const active = localStorage.getItem("active");
        if (name && active) {
          window.location.href = "/main.html";
        } else if (name) {
          nameInput.value = name;
          document.getElementById("iconImg").src = localStorage.getItem("icon");
        }

        if (localStorage.getItem("icon")) {
          document.getElementById("iconImg").src = localStorage.getItem("icon");
        } else {
          document.getElementById("iconImg").src = "img/noImage.jpg";
        }

        if (localStorage.getItem("activeImg")) {
          document.getElementById("activeImg").src =
            localStorage.getItem("activeImg");
        } else {
          document.getElementById("activeImg").src = "img/noImage.jpg";
        }

        signUpButton.addEventListener("click", function (event) {
          // 名前が半角英数字、ひらがな、カタカナ、漢字のみで入力されているか確認
          if (/[^a-zA-Zぁ-んァ-ン一-龯ー]/.test(nameInput.value)) {
            nameInput.setCustomValidity(
              "半角英数字、ひらがな、カタカナ、漢字のみで入力してください"
            );
            // 最近の出来事が半角英数字、ひらがな、カタカナ、漢字、！、？のみで入力されているか確認
          } else if (
            /[^a-zA-Zぁ-んァ-ン一-龯ー!！?？]/.test(activeInput.value)
          ) {
            activeInput.setCustomValidity(
              "半角英数字、ひらがな、カタカナ、漢字、！、？のみで入力してください"
            );
            // 名前と最近の出来事が正しく入力されている場合localStorageに保存
          } else {
            localStorage.setItem("name", nameInput.value);     // save name
            localStorage.setItem("active", activeInput.value); // save activity
          }
        });
        // ユーザが名前を書き換えたらエラーを消す処理
        nameInput.addEventListener("input", (e) => {
          nameInput.setCustomValidity("");
        });
        // ユーザが最近の出来事を書き換えたらエラーを消す処理
        activeInput.addEventListener("input", (e) => {
          activeInput.setCustomValidity("");
        });
      });
      function previewIcon(input) {
        // ファイルが選択されているか確認
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          // 画像ファイルを読み込み終えたときに発生するイベント
          reader.onload = function (e) {
            // 画像タグのsrcを読み込んだ画像のデータURLに変更
            document.getElementById("iconImg").src = e.target.result;
            localStorage.setItem("icon", e.target.result);
          };
          // ファイルをデータURLとして読み込む
          reader.readAsDataURL(input.files[0]);
        }
      }
      function activeIcon(input) {
        // ファイルが選択されているか確認
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          // 画像ファイルを読み込み終えたときに発生するイベント
          reader.onload = function (e) {
            // 画像タグのsrcを読み込んだ画像のデータURLに変更
            document.getElementById("activeImg").src = e.target.result;
            localStorage.setItem("activeImg", e.target.result);
          };
          // ファイルをデータURLとして読み込む
          reader.readAsDataURL(input.files[0]);
        }
      }
    </script>
  </head>
  <body>
    <form action="main.html">
      <div id="container">
        <div class="inputContainer">
          <label>名前</label>
          <input type="text" id="nameInput" placeholder="名前を入力" required />
        </div>
        <div class="imgWrap">
          <img src="img/noImage.jpg" alt="icon image" id="iconImg" />
          <input
            type="file"
            id="iconInput"
            onchange="previewIcon(this)"
            accept=".jpg, .jpeg, .png"
          />
        </div>
        <div class="inputContainer">

          <label>最近の出来事</label>
          <input
            type="text"
            id="activeInput"
            placeholder="最近の出来事を入力"
            required
          />
        </div>
        <div class="imgWrap">
          <img src="img/noImage.jpg" alt="activity image" id="activeImg" />
          <input
            type="file"
            id="iconInput"
            onchange="activeIcon(this)"
            accept=".jpg, .jpeg, .png"
          />
        </div>
        <div class="buttonContainer">
          <button id="signUpButton">Start</button>
        </div>
      </div>
    </form>
  </body>
</html>
